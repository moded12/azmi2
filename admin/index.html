<!-- 📄 public/index.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>المنصة التعليمية</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f9fafb; }
    .search-input { background-color: #fff; border: 1px solid #ddd; }
    .thread-card { transition: 0.3s; }
    .thread-card:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .sidebar { min-height: 100vh; background: #1f2937; color: white; }
    .sidebar a { color: white; display: block; padding: 10px 20px; text-decoration: none; }
    .sidebar a:hover { background-color: #374151; }
  </style>
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h4 class="text-center mt-4">لوحة التحكم</h4>
      <a href="../admin/add_thread.php">➕ إضافة موضوع</a>
      <a href="../admin/edit_thread.php">✏️ تعديل موضوع</a>
      <a href="../admin/delete_thread.php">🗑️ حذف موضوع</a>
      <a href="../public/index.html">🏠 مشاهدة الرئيسية</a>
    </aside>

    <div class="flex-fill">
      <!-- Header -->
      <header class="bg-gradient-to-l from-blue-600 to-cyan-500 text-white py-4 shadow sticky top-0 z-50">
        <div class="container text-center">
          <h1 class="text-3xl font-bold mb-2">📘 المنصة التعليمية</h1>
          <div class="flex flex-wrap justify-center gap-4 mt-3 text-sm">
            <a href="#" onclick="showSection('home')" class="hover:underline">🏠 الرئيسية</a>
            <a href="#" onclick="showSection('topics')" class="hover:underline">📚 المواضيع</a>
            <a href="#" onclick="showSection('about')" class="hover:underline">ℹ️ عن المنصة</a>
            <a href="#" onclick="showSection('contact')" class="hover:underline">📞 اتصل بنا</a>
          </div>
        </div>
      </header>

      <!-- Search Bar -->
      <section class="bg-sky-100 py-4 shadow">
        <div class="container text-center">
          <p class="mb-3">مناهج التعليم في سلطنة عمان للعام الدراسي 2025، قم بالبحث من خلال نوع المحتوى:</p>
          <div class="row g-2">
            <div class="col-md-2"><select id="search-class" class="form-select"><option value="">الصف الدراسي</option></select></div>
            <div class="col-md-2"><select id="search-material" class="form-select"><option value="">المادة</option></select></div>
            <div class="col-md-2"><select id="search-semester" class="form-select"><option value="">الفصل الدراسي</option></select></div>
            <div class="col-md-2"><select id="search-stage" class="form-select"><option value="">المجموعة</option></select></div>
            <div class="col-md-2"><select id="search-type" class="form-select">
              <option value="">نوع المحتوى</option>
              <option value="pdf">📄 PDF</option>
              <option value="image">🖼️ صورة</option>
              <option value="video">🎥 فيديو</option>
              <option value="doc">📄 Word</option>
            </select></div>
            <div class="col-md-1"><button class="btn btn-primary w-100" onclick="performSearch()">بحث</button></div>
            <div class="col-md-1"><button class="btn btn-secondary w-100" onclick="window.location.reload()">🔄</button></div>
          </div>
        </div>
      </section>

      <!-- Dynamic Page Sections -->
      <section class="container my-5" id="home">
        <h3 class="text-xl font-bold mb-3">🆕 أحدث المواضيع</h3>
        <div id="latest-threads" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        <nav class="mt-4" id="pagination"></nav>
      </section>

      <section class="container my-5 hidden" id="topics">
        <div class="bg-white p-4 rounded shadow">
          <h3 class="text-xl font-bold mb-3">📚 جميع المواضيع</h3>
          <p>سيتم عرض جميع المواضيع هنا حسب الترتيب أو التصنيف.</p>
        </div>
      </section>

      <section class="container my-5 hidden" id="about">
        <div class="bg-white p-4 rounded shadow">
          <h3 class="text-xl font-bold mb-3">ℹ️ عن المنصة</h3>
          <p>نحن منصة تعليمية تهدف إلى تسهيل الوصول إلى محتوى التعليم الرقمي في سلطنة عمان.</p>
        </div>
      </section>

      <section class="container my-5 hidden" id="contact">
        <div class="bg-white p-4 rounded shadow">
          <h3 class="text-xl font-bold mb-3">📞 اتصل بنا</h3>
          <p>للتواصل معنا عبر البريد: example@example.com أو الهاتف: 99999999</p>
        </div>
      </section>

      <!-- Footer -->
      <footer class="bg-gray-800 text-white text-center py-3">
        <p>© 2025 جميع الحقوق محفوظة - المنصة التعليمية</p>
      </footer>
    </div>
  </div>

  <script>
    let currentPage = 1;

    function fetchClasses() {
      fetch('../api/classes.php')
        .then(res => res.json())
        .then(data => {
          const classSelect = document.getElementById('search-class');
          classSelect.innerHTML = '<option value="">اختر الصف الدراسي</option>';
          data.forEach(cls => {
            const opt = document.createElement('option');
            opt.value = cls.id;
            opt.textContent = cls.name;
            classSelect.appendChild(opt);
          });
        });
    }

    function fetchSemesters(classId) {
      fetch(`../api/semesters.php?class_id=${classId}`)
        .then(res => res.json())
        .then(data => {
          const semesterSelect = document.getElementById('search-semester');
          semesterSelect.innerHTML = '<option value="">اختر الفصل الدراسي</option>';
          data.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.id;
            opt.textContent = s.name;
            semesterSelect.appendChild(opt);
          });
        });
    }

    function fetchMaterials(classId) {
      fetch(`../api/materials.php?class_id=${classId}`)
        .then(res => res.json())
        .then(data => {
          const materialSelect = document.getElementById('search-material');
          materialSelect.innerHTML = '<option value="">اختر المادة</option>';
          data.forEach(mat => {
            const opt = document.createElement('option');
            opt.value = mat.id;
            opt.textContent = mat.name;
            materialSelect.appendChild(opt);
          });
        });
    }

    function fetchGroups(materialId, semesterId) {
      fetch(`../api/groups.php?material_id=${materialId}&semester_id=${semesterId}`)
        .then(res => res.json())
        .then(data => {
          const groupSelect = document.getElementById('search-stage');
          groupSelect.innerHTML = '<option value="">اختر المجموعة</option>';
          data.forEach(g => {
            const opt = document.createElement('option');
            opt.value = g.id;
            opt.textContent = g.name;
            groupSelect.appendChild(opt);
          });
        });
    }

    document.getElementById('search-class').addEventListener('change', function () {
      const classId = this.value;
      if (classId) {
        fetchSemesters(classId);
        fetchMaterials(classId);
      }
    });

    document.getElementById('search-material').addEventListener('change', () => {
      const matId = document.getElementById('search-material').value;
      const semId = document.getElementById('search-semester').value;
      if (matId && semId) fetchGroups(matId, semId);
    });

    document.getElementById('search-semester').addEventListener('change', () => {
      const matId = document.getElementById('search-material').value;
      const semId = document.getElementById('search-semester').value;
      if (matId && semId) fetchGroups(matId, semId);
    });

    function loadLatest(page = 1) {
      fetch(`load_public_threads.php?page=${page}`)
        .then(res => res.text())
        .then(html => {
          document.getElementById('latest-threads').innerHTML = html;
        });
    }

    function performSearch() {
      const classId = document.getElementById('search-class').value;
      const materialId = document.getElementById('search-material').value;
      const semesterId = document.getElementById('search-semester').value;
      const groupId = document.getElementById('search-stage').value;
      const type = document.getElementById('search-type').value;

      document.getElementById('home').style.display = 'none';
      fetch(`search_threads.php?class_id=${classId}&material_id=${materialId}&semester_id=${semesterId}&group_id=${groupId}&type=${type}`)
        .then(res => res.text())
        .then(html => {
          document.getElementById('latest-threads').innerHTML = html;
        });
    }

    function showSection(sectionId) {
      ['home', 'topics', 'about', 'contact'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(sectionId).classList.remove('hidden');
    }

    window.onload = () => {
      fetchClasses();
      loadLatest(currentPage);
    }
  </script>
</body>
</html>